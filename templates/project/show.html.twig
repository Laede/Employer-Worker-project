{% extends 'base.html.twig' %}

{% block title %}Project{% endblock %}

{% block body %}
    <h1>Project</h1>

    <table class="table">
        <tbody>
        <tr>
            <th>Project Author</th>
            <td>{{project.user.name}}</td>
        </tr>
        <tr>
            <th>Name</th>
            <td>{{ project.name }}</td>
        </tr>
        <tr>
            <th>Description</th>
            <td>{{ project.description }}</td>
        </tr>
        <tr>
            <th>StartDate</th>
            <td>{{ project.startDate ? project.startDate|date('Y-m-d') : '' }}</td>
        </tr>
        <tr>
            <th>CrewCount</th>
            <td>{{ project.crewCount }}</td>
        </tr>
        <tr>
            <th>Budget</th>
            <td>{{ project.budget }}</td>
        </tr>
        <tr>
            <th>RegisterDeadline</th>
            <td>{{ project.registerDeadline ? project.registerDeadline|date('Y-m-d') : '' }}</td>
        </tr>
        <tr>
            <th>Skills</th>
            {% for skill in project.skills %}
                <td>{{ skill.name }}</td>
            {% endfor %}
        </tr>
        </tbody>
    </table>

    {% if is_granted('ROLE_EMPLOYER') %}
    <a href="{{ path('project_index') }}">back to list</a>

    <a href="{{ path('project_edit', {'id': project.id}) }}">edit</a>

    {{ include('project/_delete_form.html.twig') }}
    {% elseif is_granted('ROLE_WORKER') %}
        {% if is_granted('worker_apply', project) %}
        <a href="{{ path('worker_project_apply', {'id': project.id}) }}" class="btn btn-success">Apply</a>
        {% elseif not is_granted('project_not_applied_yet', project) and apply is defined %}
            {% include 'project/messages.html.twig' with {'messages': apply.messages} %}
            <a href="{{ path('worker_history') }}">Go back</a>
        {% endif %}
    {% endif %}

    {% if is_granted('is_project_author', project) and project.applies %}
    {% for status,applies in applies %}
        {% if applies %}
        <h3>{{ status }}</h3>
        <table class="table">
            <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>CV</th>
                <th>View</th>
            </tr>
            </thead>
            <tbody>
            {% for apply in applies %}
            <tr>
                <td>{{ apply.worker.user.fullName }}</td>
                <td>{{ apply.worker.user.email }}</td>
                <td><a target="_blank" href="{{ path('apply_cv_show', {'id': apply.id}) }}">CV</a></td>
                <td><a href="{{ path('apply_show', {'id': apply.id, 'project': project.id}) }}">Show</a></td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% endif %}
    {% endfor %}
    {% endif %}
{% endblock %}